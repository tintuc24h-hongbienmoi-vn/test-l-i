<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tin t·ª©c h√¥m nay</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f9f9f9;margin:0;color:#333}
    header{background:#007bff;color:#fff;text-align:center;padding:20px 10px}
    main{max-width:700px;margin:30px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    img{max-width:100%;border-radius:8px;margin-top:10px}
    h2{color:#007bff}
    footer{text-align:center;color:#777;font-size:14px;margin-top:30px;padding-bottom:20px}

    #popupOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:9999;justify-content:center;align-items:center}
    .popupBox{position:relative;max-width:90vw;max-height:85vh;border-radius:12px}
    .popupBox img{display:block;max-width:90vw;max-height:80vh;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.4)}
    #closeBtn{position:absolute;top:8px;right:8px;width:36px;height:36px;border-radius:50%;border:none;background:#ff3b30;color:#fff;font-size:18px;cursor:pointer}

    #confirmOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:10000;justify-content:center;align-items:center}
    .confirmBox{background:#fff;padding:18px;border-radius:12px;max-width:320px;text-align:center;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .confirmBox p{margin:0 0 12px;color:#222}
    .confirmActions{display:flex;gap:10px;justify-content:center}
    .btn{padding:8px 14px;border-radius:8px;border:none;cursor:pointer}
    .btnCancel{background:#e0e0e0}
    .btnContinue{background:#007bff;color:#fff}

    @media (max-width:420px){.confirmBox{width:86%;padding:14px}}
  </style>
</head>
<body>
  <header><h1>Tin t·ª©c m·ªõi nh·∫•t h√¥m nay</h1></header>

  <main>
    <h2>üî• Ti√™u ƒë·ªÅ b√†i vi·∫øt</h2>
    <p><em>Ng√†y ƒëƒÉng: 29/10/2025</em></p>
    <img src="https://via.placeholder.com/700x400" alt="·∫¢nh minh h·ªça c·ªßa b√†i vi·∫øt" />
    <p>ƒê√¢y l√† n·ªôi dung b√†i vi·∫øt c·ªßa b·∫°n. B·∫°n c√≥ th·ªÉ thay ti√™u ƒë·ªÅ, ·∫£nh, ho·∫∑c n·ªôi dung t√πy √Ω.</p>
  </main>

  <footer>¬© 2025 TinTuc24h HongBienMoi ‚Äî C·∫≠p nh·∫≠t li√™n t·ª•c m·ªói ng√†y</footer>

  <div id="popupOverlay" role="dialog" aria-modal="true">
    <div class="popupBox">
      <button id="closeBtn" aria-label="ƒê√≥ng">‚úï</button>
      <img id="popupImg" src="" alt="Khuy·∫øn m√£i" />
    </div>
  </div>

  <div id="confirmOverlay" role="dialog" aria-modal="true">
    <div class="confirmBox">
      <p>Trang web ƒëang ·ªü trong WebView. Nh·∫•n <strong>Ti·∫øp t·ª•c</strong> ƒë·ªÉ m·ªü b·∫±ng Chrome.</p>
      <div class="confirmActions">
        <button class="btn btnCancel" id="confirmCancel">H·ªßy</button>
        <button class="btn btnContinue" id="confirmContinue">Ti·∫øp t·ª•c</button>
      </div>
    </div>
  </div>

<script>
(function(){
  const flow = [
    { id:'shopee', img:'shopee.jpg', iosOpen:'https://s.shopee.vn/9AFwOkhPfg', androidIntent:'intent://s.shopee.vn/9AFwOkhPfg#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=https://s.shopee.vn/9AFwOkhPfg;end' },
    { id:'tiktok', img:'tiktok.jpg', iosOpen:'https://vt.tiktok.com/ZSHv3umBcrxHj-ANnIX/', androidIntent:'intent://vt.tiktok.com/ZSHv3umBcrxHj-ANnIX/#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=https://vt.tiktok.com/ZSHv3umBcrxHj-ANnIX/;end' }
  ];

  const popupOverlay = document.getElementById('popupOverlay');
  const popupImg = document.getElementById('popupImg');
  const closeBtn = document.getElementById('closeBtn');

  const confirmOverlay = document.getElementById('confirmOverlay');
  const confirmCancel = document.getElementById('confirmCancel');
  const confirmContinue = document.getElementById('confirmContinue');

  const ua = navigator.userAgent.toLowerCase();
  const isAndroid = ua.includes('android');
  const isIOS = /iphone|ipad|ipod/i.test(ua);

  const isWebView = (
    ua.includes('fbav') || ua.includes('fbios') || ua.includes('instagram') || ua.includes('messenger') || ua.includes('tiktok')
  );

  let step = parseInt(sessionStorage.getItem('popupStep') || '0', 10);

  function showIfNeeded() {
    if (!isAndroid && !isIOS) return;
    if (step >= flow.length) return;
    popupImg.src = flow[step].img;
    popupOverlay.style.display = 'flex';
  }

  window.addEventListener('load', ()=>{
    setTimeout(showIfNeeded, 150);
  });

  // NEW LOGIC for Android WebView
  function handleAndroidWebViewRedirect(linkObj){
    confirmOverlay.style.display = 'flex';

    confirmContinue.onclick = function(){
      confirmOverlay.style.display = 'none';
      // force open chrome
      window.location.href = 'intent://openchrome#Intent;scheme=https;package=com.android.chrome;end';
    };

    confirmCancel.onclick = function(){
      confirmOverlay.style.display = 'none';
      // restore step so popup shows again
      const prev = Math.max(0, step - 1);
      sessionStorage.setItem('popupStep', String(prev));
      step = prev;
      setTimeout(showIfNeeded, 200);
    };
  }

  closeBtn.addEventListener('click', ()=>{
    popupOverlay.style.display = 'none';
    sessionStorage.setItem('popupStep', String(step + 1));
    step++;

    const current = flow[step-1];

    if (isAndroid){
      if (isWebView){
        // show dialog forcing user to open Chrome
        handleAndroidWebViewRedirect(current);
        return;
      }
      // Already in Chrome ‚Üí open intent normally
      window.location.href = current.androidIntent;
      return;
    }

    if (isIOS){
      window.location.href = current.iosOpen;
      return;
    }
  });

  document.addEventListener('visibilitychange', ()=>{
    if (document.visibilityState === 'visible'){
      step = parseInt(sessionStorage.getItem('popupStep') || '0', 10);
      if (step < flow.length){ setTimeout(showIfNeeded, 200); }
    }
  });
})();
</script>

</body>
</html>
